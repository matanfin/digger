<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Fun! ‚ú®</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Baloo 2', cursive;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #fce4ec, #e8eaf6, #e0f7fa, #fff9c4);
    background-size: 400% 400%;
    animation: bgShift 12s ease infinite;
    overflow: hidden;
  }
  @keyframes bgShift {
    0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%}
  }

  .container {
    text-align: center;
    background: rgba(255,255,255,0.85);
    border-radius: 30px;
    padding: 40px 50px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    max-width: 520px;
    width: 90%;
    position: relative;
  }

  h1 {
    font-size: 2.2em;
    font-weight: 800;
    color: #e91e63;
    margin-bottom: 5px;
  }

  .stars { font-size: 1.4em; margin-bottom: 15px; }

  .score-bar {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-bottom: 20px;
    font-size: 1.1em;
    font-weight: 700;
  }
  .score-bar .correct { color: #4caf50; }
  .score-bar .wrong { color: #f44336; }
  .score-bar .streak { color: #ff9800; }

  .problem {
    font-size: 3.2em;
    font-weight: 800;
    color: #333;
    margin: 20px 0 15px;
    letter-spacing: 2px;
  }
  .problem .op { color: #e91e63; }

  #answer {
    font-family: 'Baloo 2', cursive;
    font-size: 2.4em;
    font-weight: 700;
    text-align: center;
    width: 160px;
    padding: 8px 15px;
    border: 4px solid #ce93d8;
    border-radius: 18px;
    outline: none;
    color: #333;
    background: #fce4ec;
    transition: border-color 0.3s;
  }
  #answer:focus { border-color: #e91e63; background: #fff; }

  .btn {
    font-family: 'Baloo 2', cursive;
    font-size: 1.5em;
    font-weight: 700;
    padding: 10px 40px;
    border: none;
    border-radius: 18px;
    cursor: pointer;
    margin-top: 15px;
    color: #fff;
    background: linear-gradient(135deg, #e91e63, #9c27b0);
    box-shadow: 0 4px 15px rgba(233,30,99,0.3);
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(233,30,99,0.4); }
  .btn:active { transform: scale(0.97); }

  /* Feedback overlay */
  .feedback-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 100;
    animation: fadeIn 0.3s ease;
  }
  .feedback-overlay.correct-bg {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9, #a5d6a7);
  }
  .feedback-overlay.wrong-bg {
    background: linear-gradient(135deg, #ffebee, #ffcdd2, #ef9a9a);
  }
  @keyframes fadeIn { from{opacity:0} to{opacity:1} }

  .feedback-emoji {
    font-size: 10em;
    animation: bounceIn 0.5s ease;
  }
  @keyframes bounceIn {
    0%{transform:scale(0)} 50%{transform:scale(1.2)} 100%{transform:scale(1)}
  }

  .feedback-text {
    font-size: 2.2em;
    font-weight: 800;
    margin-top: 10px;
  }
  .feedback-text.yay { color: #2e7d32; }
  .feedback-text.oops { color: #c62828; }

  .feedback-answer {
    font-size: 1.3em;
    font-weight: 600;
    color: #555;
    margin-top: 5px;
  }

  .timer-bar {
    width: 300px;
    height: 10px;
    background: rgba(0,0,0,0.1);
    border-radius: 5px;
    margin-top: 20px;
    overflow: hidden;
  }
  .timer-fill {
    height: 100%;
    border-radius: 5px;
    animation: timerShrink 7s linear forwards;
  }
  .timer-fill.green { background: #4caf50; }
  .timer-fill.red { background: #f44336; }
  @keyframes timerShrink { from{width:100%} to{width:0%} }

  /* Character display for correct answers */
  .character-display {
    width: 220px;
    height: 220px;
    margin: 0 auto 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 12em;
    animation: bounceIn 0.5s ease;
  }

  /* Confetti */
  .confetti {
    position: fixed;
    top: -10px;
    width: 10px;
    height: 10px;
    border-radius: 2px;
    animation: confettiFall linear forwards;
    z-index: 101;
    pointer-events: none;
  }
  @keyframes confettiFall {
    to { top: 110vh; transform: rotate(720deg); }
  }

  /* Floating decorations */
  .deco {
    position: fixed;
    font-size: 2em;
    opacity: 0.3;
    animation: floaty 6s ease-in-out infinite;
    pointer-events: none;
    z-index: -1;
  }
  @keyframes floaty {
    0%,100%{transform:translateY(0)} 50%{transform:translateY(-20px)}
  }

  .hint {
    font-size: 0.95em;
    color: #999;
    margin-top: 8px;
  }
</style>
</head>
<body>

<!-- Floating decorations -->
<div class="deco" style="top:10%;left:5%;animation-delay:0s">üå∏</div>
<div class="deco" style="top:20%;right:8%;animation-delay:1s">‚≠ê</div>
<div class="deco" style="top:60%;left:8%;animation-delay:2s">ü¶ã</div>
<div class="deco" style="top:70%;right:5%;animation-delay:0.5s">üåà</div>
<div class="deco" style="top:40%;left:3%;animation-delay:1.5s">üíñ</div>
<div class="deco" style="top:85%;right:12%;animation-delay:3s">‚ú®</div>

<div class="container" id="gameArea">
  <h1>Math Fun! ‚ú®</h1>
  <div class="stars">üåü Addition & Subtraction üåü</div>

  <div class="score-bar">
    <span class="correct">‚úÖ <span id="correctCount">0</span></span>
    <span class="streak">üî• <span id="streakCount">0</span></span>
    <span class="wrong">‚ùå <span id="wrongCount">0</span></span>
  </div>

  <div class="problem" id="problem">...</div>

  <div>
    <input type="number" id="answer" autofocus autocomplete="off" placeholder="?">
  </div>

  <button class="btn" id="checkBtn" onclick="checkAnswer()">Check! ‚ú®</button>

  <div class="hint">Press Enter to check your answer</div>
</div>

<div class="feedback-overlay" id="feedbackOverlay" style="display:none"></div>

<script>
// Fun dog emojis with character name labels
const REWARDS = [
  { emoji: 'üê∂', name: 'Bluey' },
  { emoji: 'üêï', name: 'Bingo' },
  { emoji: 'ü¶ä', name: 'Muffin' },
  { emoji: 'üêæ', name: 'Socks' },
  { emoji: 'üê∫', name: 'Bandit' },
  { emoji: 'üê©', name: 'Chilli' },
  { emoji: 'üêï‚Äçü¶∫', name: 'Stripe' },
  { emoji: 'ü¶Æ', name: 'Lucky' },
];
const PRAISE = [
  'Amazing! üéâ', 'Super Star! ‚≠ê', 'You Rock! ü§©', 'Brilliant! üíñ',
  'Wow! Perfect! üåü', 'Fantastic! üéä', 'Great Job! üí™', 'Awesome! ü•≥',
  'Wonderful! üåà', 'You\'re a Genius! üß†'
];
const ENCOURAGE = [
  'Almost! Try again! üí™', 'Oopsie! You\'ll get it! üåü',
  'Not quite! Keep going! üíñ', 'So close! Next one! ‚ú®',
  'Don\'t worry! You\'re learning! üåà'
];

// Fail sounds - opus files and synthesized fart
function sfxFart() {
  const r = Math.random();
  if (r < 0.33) {
    new Audio('2.opus').play().catch(() => {});
  } else if (r < 0.66) {
    new Audio('3.opus').play().catch(() => {});
  } else {
    // Synthesized fart
    const c = new (window.AudioContext || window.webkitAudioContext)();
    const now = c.currentTime, dur = 0.9;
    const osc = c.createOscillator(), g = c.createGain();
    osc.connect(g); g.connect(c.destination); osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(100, now);
    for (let t = 0; t < dur; t += 0.07) osc.frequency.setValueAtTime(80 + Math.random()*40, now + t);
    osc.frequency.exponentialRampToValueAtTime(30, now + dur);
    g.gain.setValueAtTime(0.15, now); g.gain.linearRampToValueAtTime(0, now + dur);
    osc.start(now); osc.stop(now + dur);
    const buf = c.createBuffer(1, c.sampleRate * dur, c.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < d.length; i++) d[i] = (Math.random()*2-1) * Math.exp(-i/c.sampleRate*3) * 0.5;
    const ns = c.createBufferSource(); ns.buffer = buf;
    const lp = c.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 250;
    const ng = c.createGain(); ng.gain.setValueAtTime(0.12, now); ng.gain.linearRampToValueAtTime(0, now + dur);
    ns.connect(lp); lp.connect(ng); ng.connect(c.destination);
    ns.start(now); ns.stop(now + dur);
  }
}
let fartCtx;

let num1, num2, operator, correctAnswer;
let correctCount = 0, wrongCount = 0, streak = 0;
let feedbackTimer = null;
let isShowingFeedback = false;

function generateProblem() {
  // Generate age-appropriate problems for 2nd grade (0-100)
  operator = Math.random() < 0.5 ? '+' : '‚àí';

  if (operator === '+') {
    // Addition: result should be <= 10
    num1 = Math.floor(Math.random() * 9) + 1;    // 1‚Äì9
    num2 = Math.floor(Math.random() * (10 - num1)) + 1; // ensure sum ‚â§ 10
    correctAnswer = num1 + num2;
  } else {
    // Subtraction: result should be >= 0
    num1 = Math.floor(Math.random() * 9) + 2;    // 2‚Äì10
    num2 = Math.floor(Math.random() * num1) + 1;  // 1 to num1 (no negatives)
    correctAnswer = num1 - num2;
  }

  document.getElementById('problem').innerHTML =
    `${num1} <span class="op">${operator}</span> ${num2} = ?`;

  const input = document.getElementById('answer');
  input.value = '';
  input.focus();
}

function checkAnswer() {
  if (isShowingFeedback) return;
  const input = document.getElementById('answer');
  const userAnswer = parseInt(input.value, 10);

  if (isNaN(userAnswer)) {
    input.style.borderColor = '#ff9800';
    setTimeout(() => input.style.borderColor = '#ce93d8', 500);
    return;
  }

  const isCorrect = userAnswer === correctAnswer;

  if (isCorrect) {
    correctCount++;
    streak++;
    document.getElementById('correctCount').textContent = correctCount;
    document.getElementById('streakCount').textContent = streak;
  } else {
    wrongCount++;
    streak = 0;
    document.getElementById('wrongCount').textContent = wrongCount;
    document.getElementById('streakCount').textContent = streak;
  }

  showFeedback(isCorrect, userAnswer);
}

function showFeedback(isCorrect, userAnswer) {
  isShowingFeedback = true;
  const overlay = document.getElementById('feedbackOverlay');

  if (isCorrect) {
    const reward = REWARDS[Math.floor(Math.random() * REWARDS.length)];
    const praise = PRAISE[Math.floor(Math.random() * PRAISE.length)];
    overlay.className = 'feedback-overlay correct-bg';
    overlay.innerHTML = `
      <img src="1.jpeg" alt="Great job!" style="width:260px;max-height:300px;border-radius:20px;object-fit:contain;box-shadow:0 8px 30px rgba(0,0,0,.15);animation:bounceIn .5s ease">
      <div class="feedback-text yay" style="font-size:1.6em;color:#1565c0">${reward.name} says:</div>
      <div class="feedback-text yay">${praise}</div>
      <div class="feedback-answer">${num1} ${operator} ${num2} = ${correctAnswer} ‚úÖ</div>
      <div class="timer-bar"><div class="timer-fill green"></div></div>
    `;
    spawnConfetti();
  } else {
    const encourage = ENCOURAGE[Math.floor(Math.random() * ENCOURAGE.length)];
    overlay.className = 'feedback-overlay wrong-bg';
    sfxFart();
    overlay.innerHTML = `
      <div style="font-size:8em;animation:bounceIn .5s ease">üßíüí¶</div>
      <div class="feedback-text oops">${encourage}</div>
      <div class="feedback-answer">
        You said ${userAnswer}, but ${num1} ${operator} ${num2} = <b>${correctAnswer}</b>
      </div>
      <div class="timer-bar"><div class="timer-fill red"></div></div>
    `;
  }

  overlay.style.display = 'flex';

  clearTimeout(feedbackTimer);
  feedbackTimer = setTimeout(() => {
    overlay.style.display = 'none';
    isShowingFeedback = false;
    generateProblem();
  }, 7000);
}

function spawnConfetti() {
  const colors = ['#e91e63','#9c27b0','#2196f3','#4caf50','#ff9800','#ffeb3b','#00bcd4'];
  for (let i = 0; i < 40; i++) {
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + 'vw';
    c.style.background = colors[Math.floor(Math.random() * colors.length)];
    c.style.animationDuration = (2 + Math.random() * 3) + 's';
    c.style.animationDelay = Math.random() * 0.8 + 's';
    c.style.width = (6 + Math.random() * 8) + 'px';
    c.style.height = (6 + Math.random() * 8) + 'px';
    c.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 6000);
  }
}

// Enter key to submit
document.getElementById('answer').addEventListener('keydown', e => {
  if (e.key === 'Enter') checkAnswer();
});

// Allow clicking overlay to dismiss early
document.getElementById('feedbackOverlay').addEventListener('click', () => {
  if (!isShowingFeedback) return;
  clearTimeout(feedbackTimer);
  document.getElementById('feedbackOverlay').style.display = 'none';
  isShowingFeedback = false;
  generateProblem();
});

// Start
generateProblem();
</script>
</body>
</html>
